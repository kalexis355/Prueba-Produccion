<div class="container-fluid d-flex flex-column h-100 overflow-x-hidden overflow-y-auto contenedor">

  <div>

    <div class="row  d-flex justify-content-between">

      <div class="col-7 d-flex align-items-center mt-3 ms-3   ">
        <a class="ruta me-2 mt-1 fs-5" [routerLink]="['/dashboard']">Mis archivos</a><img
          src="assets/imgs/flechas-a-la-derecha.png" alt="" height="20">
        <!-- <div *ngFor="let rutica of rutaService.guardarRuta()">
            <a class=" ruta fs-5" routerLinkActive="active"  [routerLink]="['/dashboard/carpeta',rutica.id]">{{rutica.nombre}}
              <img src="assets/imgs/flechas-a-la-derecha.png"alt="separador"height="20">
            </a>
          </div> -->
        <a href=""></a>
      </div>


      <!-- *ngIf="puedeSubirArchivos && esSerieOSubserie" -->
      <div class="col-2 mt-3" *ngIf="esSerieOSubserie">
        <label class="btn btun2 rounded-pill d-flex align-items-center">
          <img src="/assets/imgs/archivoMas.png" alt="">
          <span class="fs-5 ps-2">Subir Archivo</span>

          <input type="file" style="display: none;" (change)="subirArchivo($event)" multiple>
        </label>
      </div>
      <!--  -->
      <div class="col-2 mt-3 " *ngIf="puedeCrearCarpetas">

        <dashboard-btn-mas></dashboard-btn-mas>
      </div>
    </div>
    <!--  -->
    <div *ngIf="carpetaContenido.length === 0 && DocumentoContenido.length === 0">
      <div class="col-12 d-flex justify-content-center mt-5">
        <img src="assets/imgs/vacia.png" alt="imagen Vacia" height="300" width="400">
      </div>

      <h3 class="d-flex justify-content-center texto3">La carpeta esta vacia</h3>
    </div>

    <!-- <div class="row d-flex justify-content-center mt-2 mb-2">

        <div class="col-6 opciones rounded-pill">
          <app-opciones-carpeta></app-opciones-carpeta>
        </div>
      </div> -->



    <div class="ms-3 mt-2" *ngIf="carpetaContenido.length !== 0">
      <h4>Carpetas</h4>
      <div class="row g-5  ">
        <ng-container *ngFor="let carpeta of carpetasFiltradas">
          <div class="col-md-2">
            <div class="btun d-flex flex-column justify-content-between align-items-end "
              (contextmenu)="mostrarMenuContextual($event, carpeta)">
              <input type="checkbox" class="form-check-input">

              <button class="btn btun "
              [class.carpeta-cortar]="(hayCarpetaSeleccionada && carpeta.Cod === carpetaParaCortar) ||
                                      (hayCarpetaSeleccionada && carpeta.Cod === carpetaParaCopiar)"
              [routerLink]="['/dashboard/carpeta',carpeta.Cod]"
              [state]="{ carpetaHija: carpeta }">
                <img class="mt-2" src="/assets/imgs/carpeta-vacia2.png" alt="archivo" width="100" height="100">
                <h4 class="mt-2 mb-0 texto" [title]="carpeta.Nombre">{{carpeta.Nombre}}</h4>
              </button>
            </div>

          </div>

        </ng-container>
      </div>
    </div>


      <div class="ms-3 mt-2" *ngIf="DocumentoContenido.length !== 0">
        <h4>Archivos</h4>
        <div class="row g-5  ">
          <ng-container *ngFor="let archivo of DocumentoContenido">
            <div class="col-md-2">
              <div class="btun d-flex flex-column justify-content-between align-items-end ">
                <input type="checkbox" class="form-check-input">

                <button class="btn btun " (click)="openVisualizador(archivo)">
                  <img class="mt-2" [src]="obtenerImagenPrevisualizacion(archivo.Formato)" alt="archivo" width="100"
                    height="100">
                  <h4 class="mt-2 mb-0 texto" [title]="archivo.Nombre">{{archivo.Nombre }}</h4>
                </button>
              </div>

            </div>

          </ng-container>
        </div>

      </div>

    <!-- Menú contextual -->
    <!-- <div class="menu-contextual" *ngIf="menuVisible" [style.left.px]="menuPosX" [style.top.px]="menuPosY">
      <ul>
        <li><i class="fa-regular fa-share-from-square"></i> Compartir</li>
        <li><i class="fa-regular fa-circle-down"></i> Descargar</li>
        <li (click)="eliminarCarpeta(carpetaSeleccionada)"><i class="fa-regular fa-trash-can"></i> Eliminar</li>
        <li (click)="cortarCarpeta(carpetaSeleccionada)"
        [class.disabled]="habilitarOpcion"
        [attr.disabled]="habilitarOpcion ? true : null">
        <i class="fa-solid fa-scissors"></i> Cortar</li>
        <li (click)="pegarCarpeta(carpetaSeleccionada)"><i class="fa-solid fa-paste"></i> Pegar</li>
        <li (click)="otraOpcion()"><i class="fa-regular fa-pen-to-square"></i> Cambiar Nombre</li>
        <li class="nav-item" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight" aria-controls="offcanvasRight"
          (click)="verDetalles(carpetaSeleccionada)"><i class="fa-solid fa-bars"></i> Ver detalles</li>
        <li (click)="eliminarAccion()" class="cancelar" *ngIf="habilitarOpcion">1 elemento Cancelar <i class="fa-solid fa-circle-xmark"></i></li>
      </ul>
    </div> -->

    <!-- Menú contextual -->
<div class="menu-contextual" *ngIf="menuVisible" [style.left.px]="menuPosX" [style.top.px]="menuPosY">
  <ul>
    <li><i class="fa-regular fa-share-from-square"></i> Compartir</li>
    <li><i class="fa-regular fa-circle-down"></i> Descargar</li>
    <li><i class="fa-regular fa-pen-to-square"></i> Cambiar Nombre</li>

    <!-- Submenú Organizar -->
    <li class="submenu">
      <span><i class="fa-regular fa-folder"></i> Organizar
        <i  class="fa-solid" [class.fa-chevron-right]="submenuPosition === 'right'"
        [class.fa-chevron-left]="submenuPosition === 'left'"></i></span>

      <ul class="submenu-content" [class.left]="submenuPosition === 'left'">
        <li (click)="eliminarCarpeta(carpetaSeleccionada)"
        [class.disabled]="habilitarOpcionEliminar"
        [attr.disabled]="habilitarOpcionEliminar ? true : null">
        <i class="fa-regular fa-trash-can"></i> Eliminar
        </li>
        <li (click)="cortarCarpeta(carpetaSeleccionada)"
            [class.disabled]="habilitarOpcionCortar"
            [attr.disabled]="habilitarOpcionCortar ? true : null">
          <i class="fa-solid fa-scissors"></i> Cortar
        </li>
        <li (click)="pegarCarpeta(carpetaSeleccionada)"
        [class.disabled]="habilitarParaPegar"
        [attr.disabled]="habilitarParaPegar ? true : null">
          <i class="fa-solid fa-paste"></i> Pegar
        </li>
        <li (click)="copiarCarpeta(carpetaSeleccionada)"
        [class.disabled]="habilitarOpcionCopiar"
        [attr.disabled]="habilitarOpcionCopiar ? true : null">
          <i class="fa-solid fa-copy"></i> Copiar
        </li>
      </ul>
    </li>

    <li class="nav-item" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight"
        aria-controls="offcanvasRight" (click)="verDetalles(carpetaSeleccionada)">
      <i class="fa-solid fa-bars"></i> Ver detalles
    </li>

    <li (click)="eliminarAccion()" class="cancelar" *ngIf="hayCarpetaSeleccionada">
      <i class="fa-solid fa-circle-xmark"></i> Cancelar
    </li>
  </ul>
</div>

    <div class="offcanvas offcanvas-end w-25" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel">
      <div class="container">

        <div class="mt-3 d-flex justify-content-center">
          <p class="fs-4 fw-light"><i class="fa-regular fa-folder-open"></i> {{carpetaSeleccionada.Cod}}.
            {{carpetaSeleccionada.Nombre}}</p>
        </div>
        <hr>

        <div class="d-flex justify-content-center">
          <button class="btn btun " data-bs-dismiss="offcanvas"
            [routerLink]="['/dashboard/carpeta',carpetaSeleccionada.Cod]">
            <img class="mt-2" src="/assets/imgs/carpeta-vacia2.png" alt="archivo" width="100" height="100">
          </button>
        </div>

        <div class="mt-3 ms-2">
          <p class="fs-5 mb-1">Usuarios Delegados</p>
          <p *ngIf="carpetaSeleccionada.Delegado>0">{{obtenerNombreDelegado()}}</p>
          <p class="m-0 me-1" *ngIf="carpetaSeleccionada.Delegado===0">
            No hay usuarios delegados asignados con permisos para ver o editar esta carpeta</p>
        </div>
        <hr>

        <div class="ms-2 detalles-carpeta">
          <p>Detalles de la carpeta</p>
          <p class="subtitulo mb-0">Tipo</p>
          <p class="mt-0 subtitulo2">{{carpetaSeleccionada.NombreTipoCarpeta}}</p>

          <p *ngIf="carpetaSeleccionada.TipoCarpeta===2" class="subtitulo mb-0">Codigo Subserie</p>
          <p *ngIf="carpetaSeleccionada.TipoCarpeta===2" class="mt-0 subtitulo2">{{carpetaSeleccionada.CodSubSerie}}</p>

          <p class="subtitulo mb-0">Estado</p>
          <p class="mt-0 subtitulo2">{{obtenerNombreEstadoCarpeta()}}</p>

          <p class="subtitulo mb-0">Descripción</p>
          <p class="mt-0 subtitulo2">{{carpetaSeleccionada.Descripcion}}</p>

          <p class="subtitulo mb-0">Copia</p>
          <p class="mt-0 subtitulo2">{{ carpetaSeleccionada.Copia ? 'Si es una copia' : 'No es una copia' }}</p>

          <p class="subtitulo mb-0">Visualización</p>
          <p class="mt-0 subtitulo2">{{ carpetaSeleccionada.NivelVisualizacion }}</p>


          <p class="subtitulo mb-0">Fecha de Creación</p>
          <p class="mt-0 subtitulo2">{{ carpetaSeleccionada.FechaCreacion | date: 'dd/MM/yyyy' }}</p>



        </div>

      </div>
    </div>
